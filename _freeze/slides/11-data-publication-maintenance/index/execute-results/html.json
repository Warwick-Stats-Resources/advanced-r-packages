{
  "hash": "c88909ef2115537ff3686889f65ae391",
  "result": {
    "markdown": "---\ntitle: Packaging Data; Publication and Maintenance\nsubtitle: Advanced R\nauthor: \n  - name: Heather Turner and Ella Kaye\n  - name: Department of Statistics, University of Warwick\ntitle-slide-attributes:\n  data-background-color: \"#552D62\"\ndate: 2023-06-21\ndate-format: long\nformat: \n  warwickpres-revealjs:\n    execute:\n      echo: true\n      code-overflow: wrap\n---\n\n\n## Overview\n\n- Packaging data\n- Publication\n  - GitHub\n  - R-Universe\n  - CRAN\n- Promotion\n- Maintenance\n\n::: {.notes}\nThe packaging data section would more naturally fit earlier in the course, but put here because of how the schedule has panned out.  \n:::\n\n# Packaging data {.inverse}\n\n## Including data\n\nThere are 3 types of data we might want to include:\n\n- Exported data for the user to access: put in `/data`\n- Internal data for functions to access: put in `/R/sysdata.rda`\n- Raw data: put in `/inst/extdata`\n\n## Exported data\n\nThe data should be saved in `/data` as an `.rda` (or `.RData`) file.\n\n`usethis::use_data()` will do this for you, as well as a few other necessary steps:\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nletter_indices <- data.frame(letter = letters, index = seq_along(letters))\nusethis::use_data(letter_indices)\n```\n:::\n\n\n```\n✔ Adding 'R' to Depends field in DESCRIPTION\n✔ Creating 'data/'\n✔ Setting LazyData to 'true' in 'DESCRIPTION'\n✔ Saving 'letter_indices' to 'data/letter_indices.rda'\n• Document your data (see 'https://r-pkgs.org/data.html')\n```\n\n. . .\n\n:::{.callout-note}\nFor larger datasets, you can try changing the `compress` argument to get the best compression.\n:::\n\n## Provenance\n\nOften the data that you want to make accessible to the users is one you have created with an R script -- either from scratch or from a raw data set.\n\nIt's a good idea to put the R script and any corresponding raw data in `/data-raw`.\n\n`usethis::use_data_raw(\"dataname\")` will set this up:\n\n - Create `/data-raw`\n - Add `/data-raw/dataname.R` for you to add the code needed to create the data\n - Add `^data-raw$` to `.Rbuildignore` as it does not need to be included in the actual package.\n\nYou should add any raw data files (e.g. `.csv` files) to `/data-raw`.\n\n## Documenting Data\n\nDatasets in `/data` are always exported, so **must** be documented.\n\nTo document a dataset, we must have an `.R` script in `/R` that contains a Roxygen block above the name of the dataset.\n\nAs with functions, you can choose how to arrange this, e.g. in one combined `/R/data.R` or in a separate R file for each dataset.\n\n## Example: letter_indices\n\n```\n#' Letters of the Roman Alphabet with Indices\n#'\n#' A dataset of lower-case letters of the Roman alphabet and their \n#' numeric index from a = 1 to z = 26.\n#'\n#' @format A data frame with 26 rows and 2 variables:\n#' \\describe{\n#'   \\item{letter}{The letter as a character string.}\n#'   \\item{index}{The corresponding numeric index.}\n#' }\n\"letter_indices\"\n```\n\n`#' @ examples` can be used here too.\n\n## Data source\n\nFor collected data, the (original) source should be documented with `#' @source`.\n\nThis should either be a url, e.g.\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n#' @source \\url{http://www.diamondse.info/}\n```\n:::\n\n(alternatively `\\href{DiamondSearchEngine}{http://www.diamondse.info/}`), or a reference, e.g.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n#' @source Henderson and Velleman (1981), Building multiple  \n#' #' regression models interactively. *Biometrics*, **37**, 391–411.\n```\n:::\n\n\n## Internal data\n\nSometimes functions need access to reference data, e.g. constants or look-up tables, that don't need to be shared with users.\n\nThese objects should be saved in a single `R/sysdata.rda` file.\n\nThis can be done with `use_data(..., internal = TRUE)`, e.g.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nx <- sample(1000)\nusethis::use_data(x, mtcars, internal = TRUE)\n```\n:::\n\n\nThe generating code and any raw data can be put in `/data-raw`.\n\nAs the objects are not exported, they don't need to be documented.\n\n## Raw data\n\nSometimes you want to include raw data, to use in examples or vignettes.\n\nThese files can be any format and should be added directly into `/inst/extdata`.\n\nWhen the package is installed, these files will be copied to the `extdata` directory and their path on your system can be found as follows:\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nsystem.file(\"extdata\", \"mtcars.csv\", package = \"readr\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"/Users/u2175871/Library/R/arm64/4.3/library/readr/extdata/mtcars.csv\"\n```\n:::\n:::\n\n\n## Your turn\n\n1. Run `usethis::use_data_raw(\"farm_animals\")`.\n2. In the script `data-raw/farm_animals.R` write some code to create a small data frame with the names of farm animals and the sound they make.\n3. Run all the code (including the already-present call to `usethis::use_data()`) to create the data and save it in `/data`.\n4. Add an `R/farm_animals.R` script and add some roxygen comments to document the function.\n5. Run `devtools::document()` to create the documentation for the `farm_animals` data. Preview the documentation to check it.\n6. Commit all the changes to your repo.\n\n# Publication {.inverse}\n\n# GitHub {.inverse}\n\n## Your package is already on GitHub\n\nSince your package is already on GitHub, any R user can install it with\n\n```r\nremotes::install_github(\"USER/REPO\")\n```\n\nIf you want to tag it as a release, make sure there's a `NEWS.md` file then run\n\n```r\nusethis::use_version() # set the release version number\n```\n\nCheck the `NEWS.md` file is up-to-date (`use_version()` will modify it) then \n\n```\nusethis::use_github_release()\n```\n\nThis will bundle the source code as a `zip` and a `tar.gz` and make them available from the **Releases** section of the repo homepage.\n\n::: {.notes}\nSee previous session for details about NEWS.md and `usethis::use_news_md()`\n\nuse_github_release() is also part of the CRAN submission process, towards the end of the `use_release_issue()` to-do list.\n:::\n\n# R-Universe {.inverse}\n\n## R-Universe\n\nWith [R-Universe](https://r-universe.dev/), you can create a personal, CRAN-like repository.\n\nYou're in control of what's published in your R-Universe! \n\nIt is a good way to allow users to easily install packages without going through the rigour of the CRAN submission process.\n\nUseful resources:\n\n- Search the whole R-universe: <https://r-universe.dev/search/>\n- About the R-universe: <https://ropensci.org/r-universe/>\n- R-universe help-page: <https://github.com/r-universe-org/help>\n\n::: {.notes}\nA project from rOpenSci  \n:::\n\n## Installing a package from an R-universe\n\nBinaries are built for Windows and MacOS, which a user can install using \n`install.packages()`, e.g.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# Install 'malt' from the 'lrioudurand' universe\ninstall.packages('malt', repos = c(\n  lrioudurand = 'https://lrioudurand.r-universe.dev',\n  CRAN = 'https://cloud.r-project.org')  \n)\n```\n:::\n\n\n. . .\n\nAlternatively, you can first set `options(repos)` to enable favourite repositories by default:\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\noptions(repos = c(\n  lrioudurand = 'https://lrioudurand.r-universe.dev',\n  CRAN = 'https://cloud.r-project.org')\n)\ninstall.packages(\"malt\")\n```\n:::\n\n\n\n::: {.notes}\nThis example chosen because the universe belongs to a member of the Warwick Stats department, Lionel Riou-Durand.  \n\nTo make options persist across sessions, add this code to your .RProfile with `usethis::edit_r_profile()`\n\nCRAN repo is listed because r-universe package may have dependencies on packages on CRAN.\n:::\n\n## Create your R-universe\n\nFollow this rOpenSci guide: [How to create your personal CRAN-like repository on R-universe](https://ropensci.org/blog/2021/06/22/setup-runiverse/). \n\n:::{.smaller80}\nIn a nutshell:\n\n1. Create a repository called `<username>.r-universe.dev` on the GitHub account for `username`, e.g. <https://github.com/maelle/maelle.r-universe.dev>. The repository must contain a file called [packages.json](https://github.com/maelle/maelle.r-universe.dev/blob/main/packages.json) in the standard format, defining at least the `package` name and git `url` for the packages you want to include, e.g.\n    \n    ```\n    [\n        {\n            \"package\": \"malt\",\n            \"url\": \"https://github.com/lrioudurand/malt\"\n        }\n    ]\n    ```\n\n2. Install the [r-universe app](https://github.com/apps/r-universe/installations/new) on the GitHub account that you want to enable. Choose __enable for all repositories__ when asked.\n:::\n\n::: {.notes}\nCopying the example from the r-universe help page, with the example/links to Maelle, but using the example json from Lionel to be consistent with previous slide.  \n\nMight be worth pointing out that with actual username, don't need `< >`\n:::\n\n## What happens next\n\n- After a few minutes, your source universe will appear on: `https://github.com/r-universe/<username>`\n\n- The universe automatically starts building the packages from your registry. Once finished, they will appear on `https://<username>.r-universe.dev`\n\n- The universe automatically syncs and builds your package git repos once per hour.\n\n- If you encounter any issues, the actions tab in your source universe may show what is going on, for example: <https://github.com/r-universe/maelle/actions>\n\n# CRAN {.inverse}\n\n## Why publish on CRAN?\n\n- Sign of quality\n\n   - Code is ready to be used (not a beta version)\n   - Basic standards: documented code, running examples, etc\n   - Works with current version of R and other packages \n   - Commitment of maintainer\n- Discoverability\n- Ease of installation\n- Bioconductor, rOpenSci: even higher standards, code review\n\n## It's an involved process\n\n- Read the official [Checklist for CRAN Submissions](https://cran.r-project.org/web/packages/submission_checklist.html) \nto check requirements beyond the automated checks.\n\n- Read the community-created [Prepare for CRAN](https://github.com/ThinkR-open/prepare-for-cran) checklist.\n\n- Useful functions for additional checks:\n  - `goodpractice::gp`\n  - `spelling::spell_check_package`\n\n## `usethis::use_release_issue()`\n\nThis function will first ask you to select the release version (major, minor, patch) then create and open a to-do list as an issue in the package GitHub repo.\n\nFor a first submission, there are around **22** tasks to complete, split into sections, to follow (more-or-less) in order:\n\n- First release (one-time only)\n- Prepare for release\n- Submit to CRAN\n- Wait or CRAN (things to do after package has been accepted)\n\nFor more details on each, see the [Releasing to CRAN](https://r-pkgs.org/release.html) chapter of the R Packages book.\n\n::: {.notes}\nNumber of tasks may vary depending on what you've already done (e.g. use_news_md will appear on list if you haven't already got a NEWS.md file, but won't if you do.)\n\nSome are clearly optional (e.g. drafting a blog post about the release) but most should be followed.\n\nSome relate to promoting the package, rather than the technicalities of releasing it.\n\nThere are some different items for packages already on CRAN - not covered here - see Release chapter of R Packages for more details\n\nWill catch many common 'gotchas', e.g. Title Case for Title, checking all exported functions have @returns and @examples\n:::\n\n## Run \"as CRAN\" checks\n\n[CRAN policies](https://cran.r-project.org/web/packages/policies.html) state that you must run `R CMD check --as-cran` _on the tarball to be uploaded_ with the current version of R-devel.\n\nFirst make sure the package passes check locally:\n```r\ndevtools::check()\n```\n\nThen allow some extra checks:\n```r\ndevtools::check(remote = TRUE, manual = TRUE)\n```\n\nThen send to CRAN's win-builder to check on R-devel\n```r\ndevtools::check_win_devel()\n```\n\n. . . \n\n:::{.smaller80}\nFurther options: R-Hub (multiple platforms available, with different compilers) and Mac-builder (with M1)\n```r\ndevtools::check_rhub()\ndevtools::check_mac_release()\n```\n:::\n\n## `cran-comments.md`\n\nWrite submission notes, generating the `cran-comments.md` file with\n```r\nusethis::use_cran_comments()\n```\n```\n\n ## Test environments\n * local OS X install (R-release)\n * win-builder (R-release, R-devel) \n\n ## R CMD check results\n\n 0 errors | 0 warnings | 1 note\n\n * This is a new release.\n```\n\nThere’s always one note for a new submission.\n\n::: {.notes}\nuse_cran_comments() will populate cran-comments.md with the R CMD check results section. \n\nThe test environments section needs to be filled by hand\n:::\n\n## Submit to CRAN\n\n```{.r}\ndevtools::release()\n```\n\nThis asks you questions which you should carefully read and answer.\n\n::: {.notes}\nThe use_release_issue() function uses devtools::submit_cran() rather than devtools::release(), but the documentation page for submit_cran() recommends using release() instead as it performs more checks.  \n:::\n\n## If your submission fails\n\nDo not despair! It happens to everyone, even R-core members.\n\nIf it’s from the CRAN robot, just fix the problem & resubmit.\n\nIf it’s from a human, do not respond to the email and do not argue. Instead update `cran-comments.md` & resubmit.\n\n## For resubmission\n\n```\n This is a resubmission. Compared to the last submission, I\n have:\n\n * First change.\n * Second change.\n * Third change.\n\n --\n\n ## Test environments\n * local OS X install, R 3.2.2\n * win-builder (devel and release)\n\n ## R CMD check results\n ...\n```\n\n## Subsequent submissions to CRAN\n\nProceed as before. If you have reverse dependencies you need to also run \n`R CMD check` on them, and notify CRAN if you have deliberately broken them.\n\nFortunately the **revdepcheck** package makes this fairly easy\n\n```r\nremotes::install_github(\"r-lib/revdepcheck\")\nusethis::use_revdep()\nlibrary(revdepcheck)\nrevdep_check()\nrevdep_report_cran()\n```\n\n# Promotion {.inverse}\n\n## Promoting your package\n\n- Some promotion will/may be done for you: [CRANberries](https://dirk.eddelbuettel.com/cranberries/), [R Views](https://rviews.rstudio.com/) Monthly Top 40, \nsearch engines (vignette/pkgdown site)\n- Some channels are obvious: personal website, blog, Mastodon (#RStats)\n- Publicize your new package via R Weekly <https://rweekly.org/>\n    - Add to the weekly news blog, see [CONTRIBUTING](https://github.com/rweekly/rweekly.org/blob/gh-pages/CONTRIBUTING.md), and example pull requests [new package](https://github.com/rweekly/rweekly.org/pull/279), [new version](https://github.com/rweekly/rweekly.org/pull/277).\n- Would your package fit in a CRAN Task View? <https://cran.r-project.org/web/views/>\n    - Check [GitHub organization](https://github.com/cran-task-views/ctv) for how to propose addition.\n    \n::: {.notes}\nAnd Twitter, if you must.\n:::\n\n## Talks\n\n- Meetups: Warwick RUG, Coventry R-Ladies (or your local groups)\n- Conferences <https://jumpingrivers.github.io/meetingsR/events.html>\n    - **General**: useR!, posit::conf, satRdays\n    - **Specific**: R/Finance, BioC, Psychoco\n    - **Non R-specific**: Royal Statistical Society (RSS), ???\n- Conferences provide greater exposure, particular to people working in relevant\nfield(s).\n- Don't forget to share your slides! (Conference/personal website, LinkedIn, RPubs, Slideshare)\n\n## Paper\n\n:::{.smaller90}\n- A paper not only promotes your package but benefits from peer review\n    - Paper can also overlap with vignette\n- Traditional journals:\n    - **Open Source Software**: The R Journal, Journal of Statistical Software\n    - **Computing**: Computational Statistics and Data Analysis, Journal of \n    Computational and Graphical Statistics, SoftwareX\n    - **Science**: Bioinformatics, PLOS ONE, Method in Ecology and Evolution\n- Alternative journals:\n    - F1000research Bioconductor/R package gateway: publish, then open review\n    - [Journal Open Source Software](https://joss.theoj.org/): open code review, short descriptive paper\n:::   \n\n# Maintenance {.inverse}\n\n## `usethis::use_upkeep_issue()`\n\nThis is a new function in **usethis**. Like `usethis::use_release_issue()`, it opens a GitHub issue with an (opinionated) to-do list of tasks that should be ticked off for your package (at least) once a year.\n\nThe **tidyverse** team think of this like 'spring cleaning' for packages.\n\nBlog post: [Package spring cleaning](https://www.tidyverse.org/blog/2023/06/spring-cleaning-2023/)\n\n## Interacting with users\n\n- Bug reports/help requests\n    - Can show where documentation/tests need improving\n    - Help you find out who's using your package and what for\n    - Can give ideas for new features\n    - Can lead to collaborations\n- Avoid using email, so that other people can benefit\n    - GitHub issues\n    - Stackoverflow questions  \n    \n## Interacting with developers\n\n:::{.smaller80}\n* Write developer documentation -- remember you can add non-vignette articles with `usethis::use_article()`\n* Add a code of conduct, e.g. Contributor Covenant\n\n  ::: {.cell layout-align=\"center\"}\n  \n  ```{.r .cell-code}\n  usethis::use_code_of_conduct()\n  ```\n  :::\n\n* Add a CONTRIBUTING.md to your GitHub repository\n    - Do you have a style guide?\n    - Reminders to run check/tests/add NEWS item to pull requests\n* Use tags to highlight issues: the following are promoted by GitHub, e.g. `help wanted`, `good first issue`\n* Add topics to your GitHub repo so potential contributors can find it    \n:::\n\n## Consider the longer-term\n\n* Work on new features and bug fixes for the next release\n* Buddy-up\n  - Review each other's code\n  - Co-author each other's packages\n* Take advantage of events e.g. [Hacktoberfest](https://hacktoberfest.digitalocean.com/), [Closember](https://closember.org/) \n* Start work on your next package!\n\n## Congratulations 🎉 {.inverse .center .center-h}\n\nYou have written a package!\n\nAnd reached the end of the R Packages workshop!\n\n# End matter {.inverse}\n\n## References\n\nWickham, H and Bryan, J, _R Packages_ (2nd edn, in progress), <https://r-pkgs.org>.\n\nR Core Team, _Writing R Extensions_, <https://cran.r-project.org/doc/manuals/r-release/R-exts.html>\n\nrOpenSci Packages: Development, Maintenance, and Peer Review <https://devguide.ropensci.org/index.html>\n\nrOpenSci Statistical Software Peer Review (especially Chapter 3: Guide for Authors) <https://stats-devguide.ropensci.org/pkgdev.html>\n\n## License\n\nLicensed under a Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License ([CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/){target=\"_blank\"}).\n\n\n```{=html}\n<!-- needs to be last chunk of presentation otherwise creates an extra slide -->\n<!-- requires Quarto v1.3 -->\n<!-- tint80 for border, tint20 for title -->\n<!-- this should hopefully no longer be necessary in Quarto 1.4 -->\n<!-- https://github.com/quarto-dev/quarto-cli/issues/5038 -->\n<style type=\"text/css\">\ndiv.callout-note {\n  border-left-color: #336695 !important;\n}\n\ndiv.callout-note.callout-style-default .callout-title {\n  background-color: #CCD9E4 !important;\n}\n\ndiv.callout-caution {\n  border-left-color: #AE4240 !important;\n}\n\ndiv.callout-caution.callout-style-default .callout-title {\n  background-color: #ebd0cf !important;\n}\n\ndiv.callout-tip {\n  border-left-color: #618157 !important;\n}\n\ndiv.callout-tip.callout-style-default .callout-title {\n  background-color: #d8e0d5 !important;\n}\n\ndiv.callout-important {\n  border-left-color: #775781 !important;\n}\n\ndiv.callout-important.callout-style-default .callout-title {\n  background-color: #ddd5e0 !important;\n}\n\ndiv.callout-warning {\n  border-left-color: #956133 !important;\n}\n\ndiv.callout-warning.callout-style-default .callout-title {\n  background-color: #e4d8cc !important;\n}\n</style>\n```\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}