<!DOCTYPE html>
<html lang="en"><head>
<link href="../../images/warwick-university.png" rel="icon" type="image/png">
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-html/tabby.min.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-html.min.css" rel="stylesheet" data-mode="light">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.3.361">

  <meta name="author" content="Heather Turner and Ella Kaye">
  <meta name="author" content="Department of Statistics, University of Warwick">
  <meta name="dcterms.date" content="2023-06-20">
  <title>Advanced R and R Packages Workshop - C++ and Rcpp</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #adadbd;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #adadbd;  padding-left: 4px; }
    div.sourceCode
      { color: #2e2e2f;  }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #2e2e2f; } /* Normal */
    code span.al { color: #ae4240; } /* Alert */
    code span.an { color: #494957; } /* Annotation */
    code span.at { color: #775781; } /* Attribute */
    code span.bn { color: #ae4240; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #956133; } /* ControlFlow */
    code span.ch { color: #618157; } /* Char */
    code span.cn { color: #956133; } /* Constant */
    code span.co { color: #494957; } /* Comment */
    code span.cv { color: #494957; font-style: italic; } /* CommentVar */
    code span.do { color: #494957; font-style: italic; } /* Documentation */
    code span.dt { color: #ae4240; } /* DataType */
    code span.dv { color: #ae4240; } /* DecVal */
    code span.er { color: #ae4240; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ae4240; } /* Float */
    code span.fu { color: #336695; } /* Function */
    code span.im { color: #775781; } /* Import */
    code span.in { color: #494957; } /* Information */
    code span.kw { color: #2e2e2f; } /* Keyword */
    code span.op { color: #494957; } /* Operator */
    code span.ot { color: #494957; } /* Other */
    code span.pp { color: #ae4240; } /* Preprocessor */
    code span.re { color: #336695; } /* RegionMarker */
    code span.sc { color: #494957; } /* SpecialChar */
    code span.ss { color: #618157; } /* SpecialString */
    code span.st { color: #618157; } /* String */
    code span.va { color: #2e2e2f; } /* Variable */
    code span.vs { color: #618157; } /* VerbatimString */
    code span.wa { color: #494957; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="../../site_libs/revealjs/dist/theme/quarto.css">
  <link href="../../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-titled.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-titled) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-titled.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-titled .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-titled .callout-title  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-titled.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-titled.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-title {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-title {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-title {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-titled .callout-body > .callout-content > :last-child {
    margin-bottom: 0.5rem;
  }

  .callout.callout-titled .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-titled) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-title {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-title {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-title {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-title {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-title {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" data-background-color="#552D62" class="quarto-title-block center">
  <h1 class="title">C++ and Rcpp</h1>
  <p class="subtitle">Advanced R</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Heather Turner and Ella Kaye 
</div>
</div>
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Department of Statistics, University of Warwick 
</div>
</div>
</div>

  <p class="date">June 20, 2023</p>
</section>
<section id="overview" class="slide level2">
<h2>Overview</h2>
<ul>
<li>When to use C++</li>
<li>Getting set up</li>
<li>C++ basics and Rcpp</li>
<li>Rcpp sugar</li>
</ul>
</section>
<section>
<section id="when-to-use-c" class="title-slide slide level1 inverse center">
<h1>When to use C++</h1>

</section>
<section id="limits-of-r" class="slide level2">
<h2>Limits of R</h2>
<p>Sometimes you reach the limits of R:</p>
<ul>
<li>Your code is still slow despite optimizing the computational approach and the R implementation</li>
<li>You could speed up the R code, but it results in very obscure, convoluted code</li>
</ul>
<p>In this case it can make sense to code parts in C++.</p>
</section>
<section id="typical-scenarios" class="slide level2">
<h2>Typical scenarios</h2>
<p>There are some typical scenarios where C++ is likely to be a good idea</p>
<ul>
<li>Loops that can’t be vectorized because iterations depend on previous results</li>
<li>Recursive functions, or problems which involve calling functions millions of times.</li>
<li>Problems that require advanced data structures and algorithms that R doesn’t provide.</li>
</ul>
<aside class="notes">
<p>The overhead of calling a function in C++ is much lower than in R.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section></section>
<section>
<section id="getting-set-up" class="title-slide slide level1 inverse center">
<h1>Getting set up</h1>

</section>
<section id="set-up-to-use-c" class="slide level2">
<h2>Set up to use C++</h2>
<p>To use C++, you need a working C++ compiler.</p>
<p>On MacOS/Windows there is some setup to do, but it will also set you up to</p>
<ul>
<li>Develop packages in R</li>
<li>Install packages from GitHub that include C/C++ code</li>
</ul>
<p>On Linux, you will usually have a C++ compiler installed, but you might as well get set up to develop R packages too.</p>
<aside class="notes">
<p>If you’ve followed the development tools section of the course prerequisites, you should be fully set-up for this already.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="linux" class="slide level2">
<h2>Linux</h2>
<p>Debian/Ubuntu:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource sh number-lines code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1"></a><span class="ex">apt-get</span> update</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="ex">apt-get</span> install r-base-dev</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Fedora/RedHat: should be set up already.</p>
</section>
<section id="macos" class="slide level2">
<h2>MacOS</h2>
<p>Option 1</p>
<ul>
<li><a href="https://developer.apple.com/programs/register/">Register as an Apple developer (for free)</a>
<ul>
<li><p>Then, in the terminal:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource sh number-lines code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1"></a><span class="ex">xcode-select</span> <span class="at">--install</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul></li>
</ul>
<p>Option 2</p>
<ul>
<li>Install the current release of full <a href="https://itunes.apple.com/ca/app/xcode/id497799835?mt=12">Xcode from the Mac App Store</a></li>
<li>Within XCode go to Preferences -&gt; Downloads and install the Command Line Tools</li>
<li>More convenient but installs a lot you don’t need</li>
</ul>
</section>
<section id="windows" class="slide level2">
<h2>Windows</h2>
<ul>
<li>Download the Rtools installer that matches your version of R from <a href="https://cran.r-project.org/bin/windows/Rtools/" class="uri">https://cran.r-project.org/bin/windows/Rtools/</a></li>
<li>Run the installer, <code>Rtools.exe</code>, keeping the default settings.</li>
</ul>
</section></section>
<section>
<section id="c-basics-and-rcpp" class="title-slide slide level1 inverse center">
<h1>C++ basics and Rcpp</h1>

</section>
<section id="a-first-c-function" class="slide level2">
<h2>A first C++ function</h2>
<p>Consider an R function <code>add_r()</code> to add two numbers</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>add_r <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) x <span class="sc">+</span> y</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here’s how we might write an equivalent <code>add_cpp()</code> function in C++</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb4-1"><a href="#cb4-1"></a><span class="dt">double</span> add_cpp<span class="op">(</span><span class="dt">double</span> x<span class="op">,</span> <span class="dt">double</span> y<span class="op">)</span> <span class="op">{</span> </span>
<span id="cb4-2"><a href="#cb4-2"></a>  <span class="dt">double</span> value <span class="op">=</span> x <span class="op">+</span> y<span class="op">;</span></span>
<span id="cb4-3"><a href="#cb4-3"></a>  <span class="cf">return</span> value<span class="op">;</span></span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>The type for the return value is declared first</li>
<li>The type of each argument must be declared</li>
<li>The type of intermediate objects must be declared</li>
<li>Return statements must use <code>return</code></li>
</ul>
</section>
<section id="rcpp" class="slide level2">
<h2>Rcpp</h2>
<p>To use <code>add_cpp()</code> in R we need to compile the C++ code and construct an R function that connects to the compiled C++ function.</p>
<p>The R package <strong>Rcpp</strong> takes care of these steps for us.</p>
<p>One way is to use the <code>cppFunction()</code>, e.g.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="fu">library</span>(Rcpp)</span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="fu">cppFunction</span>(<span class="st">'</span></span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="st">  double add_cpp(double x, double y) {</span></span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="st">    double value = x + y;</span></span>
<span id="cb5-5"><a href="#cb5-5"></a><span class="st">    return value;</span></span>
<span id="cb5-6"><a href="#cb5-6"></a><span class="st">  }</span></span>
<span id="cb5-7"><a href="#cb5-7"></a><span class="st">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="using-the-c-function" class="slide level2">
<h2>Using the C++ function</h2>
<p>After defining <code>add_cpp()</code> via <code>cppFunction()</code>, <code>add_cpp()</code> is available to use as a R function</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>add_cpp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>function (x, y) 
.Call(&lt;pointer: 0x101150b40&gt;, x, y)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="fu">add_cpp</span>(<span class="dv">3</span>, <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 8</code></pre>
</div>
</div>
</section>
<section id="stand-alone-c-files" class="slide level2">
<h2>Stand-alone C++ files</h2>
<p>It is better to define functions in C++ files (extension <code>.cpp</code>). These files will be recognised by RStudio and other IDEs, with the usual benefits.</p>
<p>The C++ file should have these lines at the top:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb10-1"><a href="#cb10-1"></a><span class="pp">#include </span><span class="im">&lt;Rcpp.h&gt;</span></span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="kw">using</span> <span class="kw">namespace</span> Rcpp<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>The compiler will locate the Rcpp header file with functions and class definitions supplied by <strong>Rcpp</strong> and include the contents.</li>
<li>Adding the namespace means that we can use <strong>Rcpp</strong> functions in the C++ code without prefixing the function names by <code>Rcpp::</code>.</li>
</ul>
<p>Above each function we want to use in R, add <code>// [[Rcpp::export]]</code></p>
</section>
<section id="example-c-file" class="slide level2">
<h2>Example C++ file</h2>
<p>The following is in the file <code>add_cpp2.cpp</code></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb11-1"><a href="#cb11-1"></a><span class="pp">#include </span><span class="im">&lt;Rcpp.h&gt;</span></span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="kw">using</span> <span class="kw">namespace</span> Rcpp<span class="op">;</span></span>
<span id="cb11-3"><a href="#cb11-3"></a></span>
<span id="cb11-4"><a href="#cb11-4"></a><span class="co">// [[Rcpp::export]]</span></span>
<span id="cb11-5"><a href="#cb11-5"></a><span class="dt">double</span> add_cpp2<span class="op">(</span><span class="dt">double</span> x<span class="op">,</span> <span class="dt">double</span> y<span class="op">)</span> <span class="op">{</span></span>
<span id="cb11-6"><a href="#cb11-6"></a>  <span class="dt">double</span> value <span class="op">=</span> x <span class="op">+</span> y<span class="op">;</span></span>
<span id="cb11-7"><a href="#cb11-7"></a>  <span class="cf">return</span> value<span class="op">;</span></span>
<span id="cb11-8"><a href="#cb11-8"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="sourcecpp" class="slide level2">
<h2><code>sourceCpp()</code></h2>
<p>Now we can use <code>sourceCpp()</code> to make the C++ functions available in R</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>path <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"C++"</span>, <span class="st">"add_cpp2.cpp"</span>)</span>
<span id="cb12-2"><a href="#cb12-2"></a><span class="fu">sourceCpp</span>(path)</span>
<span id="cb12-3"><a href="#cb12-3"></a><span class="fu">add_cpp2</span>(<span class="dv">5</span>, <span class="dv">9</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 14</code></pre>
</div>
</div>
</section>
<section id="benefits-of-separate-c-files" class="slide level2">
<h2>Benefits of separate C++ files</h2>
<p>There are a number of benefits to writing C++ code in separate <code>.cpp</code> files, compared to <code>cppFunction()</code></p>
<ul>
<li>syntax highlighting</li>
<li>avoid mistakes switching from R to C code</li>
<li>line numbers for compilation errors</li>
<li>highlighting errors (e.g.&nbsp;missing “;”)</li>
</ul>
</section>
<section id="c-basics" class="slide level2">
<h2>C++ Basics</h2>
<ul>
<li>Every statement within <code>{</code> <code>}</code> must be terminated by a <code>;</code>.</li>
<li>Use <code>=</code> for assignment (<code>&lt;-</code> is not valid).</li>
<li>Addition, subtraction, multiplication and division use the same operators as R (<code>+</code>, <code>-</code>, <code>*</code>, <code>/</code>).</li>
<li>Comparison operators are the same as R (<code>==</code>, <code>!=</code>, <code>&gt;</code>, etc)</li>
<li>One-line comments start with <code>//</code>.</li>
<li>Multi-line comments use <code>/*</code> <code>*/</code> delimiters</li>
</ul>
<div class="sourceCode" id="cb14"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb14-1"><a href="#cb14-1"></a><span class="co">/*</span></span>
<span id="cb14-2"><a href="#cb14-2"></a><span class="co">Example</span></span>
<span id="cb14-3"><a href="#cb14-3"></a><span class="co">multi-line comment</span></span>
<span id="cb14-4"><a href="#cb14-4"></a><span class="co">*/</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="data-types" class="slide level2">
<h2>Data types</h2>
<p>The basic C++ data types are scalars. <strong>Rcpp</strong> provides vector versions <br> <br></p>
<table>
<thead>
<tr class="header">
<th>R</th>
<th>C++ (scalar)</th>
<th>Rcpp (vector)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>numeric</td>
<td>double</td>
<td>NumericVector</td>
</tr>
<tr class="even">
<td>integer</td>
<td>int</td>
<td>IntegerVector</td>
</tr>
<tr class="odd">
<td>character</td>
<td>char</td>
<td>CharacterVector</td>
</tr>
<tr class="even">
<td>logical</td>
<td>bool</td>
<td>LogicalVector</td>
</tr>
</tbody>
</table>
<p><br></p>
<p><strong>Rcpp</strong> also provides <code>String</code> as an alternative to <code>char</code></p>
<aside class="notes">
<p>Care needed with NA double: more bits used to represent a real number vs single precision - range 2<sup>-(2</sup>10) to 2<sup>(2</sup>10). vs same with 2^7 - precision ~15 d.p. vs 7</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="example-no-inputs-scalar-output" class="slide level2">
<h2>Example: no inputs, scalar output</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb15-1"><a href="#cb15-1"></a><span class="dt">int</span> one<span class="op">()</span> <span class="op">{</span></span>
<span id="cb15-2"><a href="#cb15-2"></a>  <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb15-3"><a href="#cb15-3"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="example-ifelse-scalar-input-scalar-output" class="slide level2">
<h2>Example: if/else (scalar input, scalar output)</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb16-1"><a href="#cb16-1"></a><span class="dt">int</span> signC<span class="op">(</span><span class="dt">int</span> x<span class="op">)</span> <span class="op">{</span></span>
<span id="cb16-2"><a href="#cb16-2"></a>  <span class="cf">if</span> <span class="op">(</span>x <span class="op">&gt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb16-3"><a href="#cb16-3"></a>    <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb16-4"><a href="#cb16-4"></a>  <span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>x <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb16-5"><a href="#cb16-5"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb16-6"><a href="#cb16-6"></a>  <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb16-7"><a href="#cb16-7"></a>    <span class="cf">return</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb16-8"><a href="#cb16-8"></a>  <span class="op">}</span></span>
<span id="cb16-9"><a href="#cb16-9"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="for-loop-syntax" class="slide level2">
<h2>For loop syntax</h2>
<p>A C++ <code>for</code> loop has the form</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb17-1"><a href="#cb17-1"></a><span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> n<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">{</span></span>
<span id="cb17-2"><a href="#cb17-2"></a>  total <span class="op">+=</span> x<span class="op">[</span>i<span class="op">];</span></span>
<span id="cb17-3"><a href="#cb17-3"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Syntax: <code>for (initialisation; condition; increment)</code>
<ul>
<li>Initialize integer <code>i</code> at zero</li>
<li>Continue as long as <code>i</code> is less than <code>n</code></li>
<li>Increment <code>i</code> by 1 after each iteration
<ul>
<li><code>++i</code> is equivalent to <code>i = i + 1</code></li>
</ul></li>
</ul></li>
<li><code>total += x[i]</code> is equivalent to <code>total = total + x[i]</code></li>
<li><strong>Vector indices start at zero</strong></li>
</ul>
</section>
<section id="example-for-loop-vector-input-scalar-output" class="slide level2">
<h2>Example: <code>for</code> loop (vector input, scalar output)</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb18-1"><a href="#cb18-1"></a><span class="dt">double</span> sumC<span class="op">(</span>NumericVector x<span class="op">)</span> <span class="op">{</span></span>
<span id="cb18-2"><a href="#cb18-2"></a>  <span class="dt">int</span> n <span class="op">=</span> x<span class="op">.</span>size<span class="op">();</span></span>
<span id="cb18-3"><a href="#cb18-3"></a>  <span class="dt">double</span> total <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb18-4"><a href="#cb18-4"></a>  <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> n<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">{</span></span>
<span id="cb18-5"><a href="#cb18-5"></a>    total <span class="op">+=</span> x<span class="op">[</span>i<span class="op">];</span></span>
<span id="cb18-6"><a href="#cb18-6"></a>  <span class="op">}</span></span>
<span id="cb18-7"><a href="#cb18-7"></a>  <span class="cf">return</span> total<span class="op">;</span></span>
<span id="cb18-8"><a href="#cb18-8"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Use <code>.size()</code> method to find the length of a vector</li>
</ul>
</section>
<section id="example-while-loop-vector-input-scalar-output" class="slide level2">
<h2>Example: <code>while</code> loop (vector input, scalar output)</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb19-1"><a href="#cb19-1"></a><span class="dt">double</span> sumC<span class="op">(</span>NumericVector x<span class="op">)</span> <span class="op">{</span></span>
<span id="cb19-2"><a href="#cb19-2"></a>  <span class="dt">int</span> n <span class="op">=</span> x<span class="op">.</span>size<span class="op">();</span></span>
<span id="cb19-3"><a href="#cb19-3"></a>  <span class="dt">double</span> total <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb19-4"><a href="#cb19-4"></a>  <span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb19-5"><a href="#cb19-5"></a>  <span class="cf">while</span> <span class="op">(</span>i <span class="op">&lt;</span> n<span class="op">)</span> <span class="op">{</span></span>
<span id="cb19-6"><a href="#cb19-6"></a>    total <span class="op">+=</span> x<span class="op">[</span>i<span class="op">];</span></span>
<span id="cb19-7"><a href="#cb19-7"></a>    <span class="op">++</span>i<span class="op">;</span></span>
<span id="cb19-8"><a href="#cb19-8"></a>  <span class="op">}</span></span>
<span id="cb19-9"><a href="#cb19-9"></a>  <span class="cf">return</span> total<span class="op">;</span></span>
<span id="cb19-10"><a href="#cb19-10"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Use <code>break</code> to break from a while or for loop</li>
<li>Use <code>continue</code> to skip to the next iteration (vs <code>next</code> in R)</li>
</ul>
</section>
<section id="example-vector-output" class="slide level2">
<h2>Example: vector output</h2>
<p>The following computes Euclidean distances</p>
<p><span class="math display">\[d_i  = \sqrt{(x - y_i)^2}\]</span></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb20-1"><a href="#cb20-1"></a>NumericVector distC<span class="op">(</span><span class="dt">double</span> x<span class="op">,</span> NumericVector y<span class="op">)</span> <span class="op">{</span></span>
<span id="cb20-2"><a href="#cb20-2"></a>  <span class="dt">int</span> n <span class="op">=</span> y<span class="op">.</span>size<span class="op">();</span></span>
<span id="cb20-3"><a href="#cb20-3"></a>  NumericVector dist<span class="op">(</span>n<span class="op">);</span></span>
<span id="cb20-4"><a href="#cb20-4"></a>  <span class="cf">for</span><span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> n<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">{</span></span>
<span id="cb20-5"><a href="#cb20-5"></a>    dist<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> sqrt<span class="op">(</span>pow<span class="op">(</span>ys<span class="op">[</span>i<span class="op">]</span> <span class="op">-</span> x<span class="op">,</span> <span class="fl">2.0</span><span class="op">));</span></span>
<span id="cb20-6"><a href="#cb20-6"></a>  <span class="op">}</span></span>
<span id="cb20-7"><a href="#cb20-7"></a>  <span class="cf">return</span> out<span class="op">;</span></span>
<span id="cb20-8"><a href="#cb20-8"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li><code>dist(n)</code> is used to create a numeric vector named <code>dist</code> of length <code>n</code>.</li>
<li><code>v(n)</code> would create a vector named <code>v</code>.</li>
</ul>
<aside class="notes">
<p>This is a contrived example to demonstrate Rcpp functionality. Mathematically, it’s measuring the distance between a single point, x, on the Real line and (a vector of) several other single points on the line. Given its on the Real line, absolute value is sufficient for the Euclidean distance between points - don’t need pow and sqrt, but good to show them</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="c-functions" class="slide level2">
<h2>C++ Functions</h2>
<p><code>pow</code> is a standard C++ function for computing a value raised to a power.</p>
<p>Both <code>pow</code> and <code>sqrt</code> are functions from the <code>&lt;cmath&gt;</code> library, see e.g.&nbsp;<a href="https://www.w3schools.com/cpp/cpp_math.asp">w3schools C++ math</a>.</p>
<p>To use <code>&lt;cmath&gt;</code> functions in C++ code, we would normally need to include the <code>&lt;cmath&gt;</code> header in our <code>.cpp</code> file. However, <strong>Rcpp</strong> defines its own version of these functions, so we can use them with just the <strong>Rcpp</strong> header.</p>
</section>
<section id="creating-a-c-file-in-rstudio" class="slide level2">
<h2>Creating a C++ file in RStudio</h2>
<p>From the menu bar:</p>
<ul>
<li>Go to File &gt; New File &gt; C++ file</li>
<li>This template already incleas the headers required for Rcpp</li>
<li>Delete the extra content, apart from the comment <code>//[Rcpp::export]</code></li>
</ul>
<p>You can also create a C++ file from the new file drop-down in the Files pane, but this will be blank.</p>
</section>
<section id="your-turn" class="slide level2">
<h2>Your turn</h2>
<ol type="1">
<li>Create a new C++ file (recommend using the RStudio template)</li>
<li>Convert the following R function that computes a weighted mean to C++</li>
</ol>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a>wmean_r <span class="ot">&lt;-</span> <span class="cf">function</span>(x, w){</span>
<span id="cb21-2"><a href="#cb21-2"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(x)</span>
<span id="cb21-3"><a href="#cb21-3"></a>  total <span class="ot">&lt;-</span> total_w <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb21-4"><a href="#cb21-4"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n){</span>
<span id="cb21-5"><a href="#cb21-5"></a>    total <span class="ot">&lt;-</span> total <span class="sc">+</span> x[i] <span class="sc">*</span> w[i]</span>
<span id="cb21-6"><a href="#cb21-6"></a>    total_w <span class="ot">&lt;-</span> total_w <span class="sc">+</span> w[i]</span>
<span id="cb21-7"><a href="#cb21-7"></a>  }  </span>
<span id="cb21-8"><a href="#cb21-8"></a>  total<span class="sc">/</span>total_w</span>
<span id="cb21-9"><a href="#cb21-9"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="3" type="1">
<li>Use <code>sourceCpp()</code> to source in your function.</li>
<li>Use <code>bench::mark()</code> to compare <code>wmean_r()</code>, <code>wmean_cpp()</code> and the <strong>stats</strong> function <code>weighted.mean()</code>.</li>
</ol>
</section>
<section id="missing-values-in-c-data-types" class="slide level2">
<h2>Missing values in C++ data types</h2>
<p>C++ data types do not handle <code>NA</code>s in input well</p>
<ul>
<li><code>int</code>: use a length 1 <code>IntegerVector</code> instead</li>
<li><code>double</code>: <code>NA</code>s okay (converted to <code>NAN</code>)</li>
<li><code>char</code>: use <code>String</code> instead</li>
<li><code>bool</code>: <code>NA</code>s converted to <code>true</code>; use <code>int</code> instead</li>
</ul>
</section>
<section id="missing-values-in-rcpp-vectors" class="slide level2">
<h2>Missing values in Rcpp vectors</h2>
<p>Rcpp vectors handle <code>NA</code>s in the corresponding type<br><br></p>
<table>
<thead>
<tr class="header">
<th>Rcpp (vector)</th>
<th>NA</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>NumericVector</code></td>
<td><code>NA_REAL</code></td>
</tr>
<tr class="even">
<td><code>IntegerVector</code></td>
<td><code>NA_INTEGER</code></td>
</tr>
<tr class="odd">
<td><code>CharacterVector</code></td>
<td><code>NA_STRING</code></td>
</tr>
<tr class="even">
<td><code>LogicalVector</code></td>
<td><code>NA_LOGICAL</code></td>
</tr>
</tbody>
</table>
</section>
<section id="matrices" class="slide level2">
<h2>Matrices</h2>
<p>Each vector type has a corresponding matrix equivalent: <code>NumericMatrix</code>, <code>IntegerMatrix</code>, <code>CharacterMatrix</code> and <code>LogicalMatrix</code>.</p>
<p>Create a matrix called named <code>m1</code></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb22-1"><a href="#cb22-1"></a>NumericMatrix m1<span class="op">(</span><span class="dv">10</span><span class="op">,</span> <span class="dv">5</span><span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Subset with <code>()</code>, e.g.&nbsp;<code>m1(3, 2)</code> for the value in row 3, column 2.</li>
<li>The first element is <code>m1(0, 0)</code>.</li>
<li>Use <code>.nrow</code> and <code>.ncol</code> methods to get the number of rows and columns</li>
<li>Assign matrix elements as follows</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb23-1"><a href="#cb23-1"></a>m1<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">)</span> <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="example-row-sums-matrix-input-vector-output" class="slide level2">
<h2>Example: row sums (matrix input, vector output)</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb24-1"><a href="#cb24-1"></a>NumericVector rowSumsC<span class="op">(</span>NumericMatrix x<span class="op">)</span> <span class="op">{</span></span>
<span id="cb24-2"><a href="#cb24-2"></a>  <span class="dt">int</span> nrow <span class="op">=</span> x<span class="op">.</span>nrow<span class="op">(),</span> ncol <span class="op">=</span> x<span class="op">.</span>ncol<span class="op">();</span></span>
<span id="cb24-3"><a href="#cb24-3"></a>  NumericVector out<span class="op">(</span>nrow<span class="op">);</span></span>
<span id="cb24-4"><a href="#cb24-4"></a>  </span>
<span id="cb24-5"><a href="#cb24-5"></a>  <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> nrow<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb24-6"><a href="#cb24-6"></a>    <span class="dt">double</span> total <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb24-7"><a href="#cb24-7"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> j <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> j <span class="op">&lt;</span> ncol<span class="op">;</span> j<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb24-8"><a href="#cb24-8"></a>      total <span class="op">+=</span> x<span class="op">(</span>i<span class="op">,</span> j<span class="op">);</span></span>
<span id="cb24-9"><a href="#cb24-9"></a>    <span class="op">}</span></span>
<span id="cb24-10"><a href="#cb24-10"></a>    out<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> total<span class="op">;</span></span>
<span id="cb24-11"><a href="#cb24-11"></a>  <span class="op">}</span></span>
<span id="cb24-12"><a href="#cb24-12"></a>  <span class="cf">return</span> out<span class="op">;</span></span>
<span id="cb24-13"><a href="#cb24-13"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="statistical-distributions" class="slide level2">
<h2>Statistical distributions</h2>
<p>As in R, <strong>Rcpp</strong> provides d/p/q/r functions for the density, distribution function, quantile function and random generation. - Functions in the <code>Rcpp::</code> namespace return a vector. - Functions in the <code>R::</code> namespace (also provided by the <strong>Rcpp</strong> R package) return a scalar</p>
<p>For example we can sample a single value from a <span class="math inline">\(N(0, 1)\)</span> distribution by extracting the first element from a vector</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb25-1"><a href="#cb25-1"></a>rgamma<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="dv">1</span> <span class="op">/</span> <span class="op">(</span>y <span class="op">*</span> y <span class="op">+</span> <span class="dv">4</span><span class="op">))[</span><span class="dv">0</span><span class="op">];</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Or use the <code>R::rgamma()</code> function to sample a single value directly</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb26-1"><a href="#cb26-1"></a>R<span class="op">::</span>rgamma<span class="op">(</span><span class="dv">3</span><span class="op">,</span> <span class="dv">1</span> <span class="op">/</span> <span class="op">(</span>y <span class="op">*</span> y <span class="op">+</span> <span class="dv">4</span><span class="op">))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="your-turn-part-1" class="slide level2">
<h2>Your turn (part 1)</h2>
<p>In a new C++ file, convert the following Gibbs sampler to C++</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a>gibbs_r <span class="ot">&lt;-</span> <span class="cf">function</span>(N, thin) {</span>
<span id="cb27-2"><a href="#cb27-2"></a>  mat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> N, <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb27-3"><a href="#cb27-3"></a>  x <span class="ot">&lt;-</span> y <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb27-4"><a href="#cb27-4"></a></span>
<span id="cb27-5"><a href="#cb27-5"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>N) {</span>
<span id="cb27-6"><a href="#cb27-6"></a>    <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>thin) {</span>
<span id="cb27-7"><a href="#cb27-7"></a>      x <span class="ot">&lt;-</span> <span class="fu">rgamma</span>(<span class="dv">1</span>, <span class="dv">3</span>, y <span class="sc">*</span> y <span class="sc">+</span> <span class="dv">4</span>)</span>
<span id="cb27-8"><a href="#cb27-8"></a>      y <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="dv">1</span> <span class="sc">/</span> (x <span class="sc">+</span> <span class="dv">1</span>), <span class="dv">1</span> <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="dv">2</span> <span class="sc">*</span> (x <span class="sc">+</span> <span class="dv">1</span>)))</span>
<span id="cb27-9"><a href="#cb27-9"></a>    }</span>
<span id="cb27-10"><a href="#cb27-10"></a>    mat[i, ] <span class="ot">&lt;-</span> <span class="fu">c</span>(x, y)</span>
<span id="cb27-11"><a href="#cb27-11"></a>  }</span>
<span id="cb27-12"><a href="#cb27-12"></a>  mat</span>
<span id="cb27-13"><a href="#cb27-13"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="your-turn-part-2" class="slide level2">
<h2>Your turn (part 2)</h2>
<p>Create a wrapper function to set the seed as follows:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a>gibbs_with_seed <span class="ot">&lt;-</span> <span class="cf">function</span>(expr){</span>
<span id="cb28-2"><a href="#cb28-2"></a>  <span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb28-3"><a href="#cb28-3"></a>  <span class="fu">eval</span>(expr)</span>
<span id="cb28-4"><a href="#cb28-4"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can then call <code>gibbs_r()</code> and <code>gibbs_c()</code> inside this, e.g.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a><span class="fu">gibbs_with_seed</span>(<span class="fu">gibbs_r</span>(<span class="at">N =</span> <span class="dv">100</span>, <span class="at">thin =</span> <span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Benchmark your <code>gibbs_r()</code> and <code>gibbs_c()</code> functions with N = 100 and thin = 10, using your wrapper function to set the seed.</p>
</section></section>
<section>
<section id="rcpp-sugar" class="title-slide slide level1 inverse center">
<h1>Rcpp sugar</h1>

</section>
<section id="rcpp-sugar-1" class="slide level2">
<h2>Rcpp sugar</h2>
<p>Rcpp provides some “syntactic sugar” to allow us to write C++ code that is more like R code.</p>
<p>One example is operating on rows or columns of matrices. So far we have seen how to update individual elements of a <code>NumericMatrix</code>. Rcpp lets us extract an update whole rows/columns, e.g.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource rcpp number-lines code-with-copy"><code class="sourceCode"><span id="cb30-1"><a href="#cb30-1"></a>mat(i, _) = NumericVector::create(x,y);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A whole column would be extracted with <code>mat(_, j)</code>.</p>
</section>
<section id="vectorized-functions" class="slide level2">
<h2>Vectorized functions</h2>
<p>The vectorized random generation functions are another example of Rcpp sugar.</p>
<p>Rcpp provide many more vectorized functions, for example:</p>
<ul>
<li>arithmetic operators (<code>+</code>, <code>-</code>, <code>*</code>, <code>\</code>)</li>
<li>logical operators (<code>==</code>, <code>!</code>, <code>=&lt;</code>)</li>
<li>arithmetic functions (<code>sqrt</code>, <code>pow</code>, …)</li>
<li>statistical summaries (<code>mean</code>, <code>median</code>, )</li>
</ul>
<p>In addition, Rcpp provides many R-like functions, such as <code>which_max</code> or <code>rowSums</code>, see <a href="https://thecoatlessprofessor.com/programming/cpp/unofficial-rcpp-api-documentation/#sugar">Unofficial API documentation</a> for a full list.</p>
</section>
<section id="rcpp-sugar-vectorized-functions" class="slide level2">
<h2>Rcpp sugar: vectorized functions</h2>
<p>Recall our distance function from earlier:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb31-1"><a href="#cb31-1"></a>NumericVector distC<span class="op">(</span><span class="dt">double</span> x<span class="op">,</span> NumericVector y<span class="op">)</span> <span class="op">{</span></span>
<span id="cb31-2"><a href="#cb31-2"></a>  <span class="dt">int</span> n <span class="op">=</span> y<span class="op">.</span>size<span class="op">();</span></span>
<span id="cb31-3"><a href="#cb31-3"></a>  NumericVector out<span class="op">(</span>n<span class="op">);</span></span>
<span id="cb31-4"><a href="#cb31-4"></a>  <span class="cf">for</span><span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> n<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span> <span class="op">{</span></span>
<span id="cb31-5"><a href="#cb31-5"></a>    out<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> sqrt<span class="op">(</span>pow<span class="op">(</span>ys<span class="op">[</span>i<span class="op">]</span> <span class="op">-</span> x<span class="op">,</span> <span class="fl">2.0</span><span class="op">));</span></span>
<span id="cb31-6"><a href="#cb31-6"></a>  <span class="op">}</span></span>
<span id="cb31-7"><a href="#cb31-7"></a>  <span class="cf">return</span> out<span class="op">;</span></span>
<span id="cb31-8"><a href="#cb31-8"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>With Rcpp vectorization, we can simplify this to:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb32-1"><a href="#cb32-1"></a>NumericVector dist_sugar<span class="op">(</span><span class="dt">double</span> x<span class="op">,</span> NumericVector y<span class="op">)</span> <span class="op">{</span></span>
<span id="cb32-2"><a href="#cb32-2"></a>  <span class="cf">return</span> sqrt<span class="op">(</span>pow<span class="op">(</span>x <span class="op">-</span> y<span class="op">,</span> <span class="dv">2</span><span class="op">));</span></span>
<span id="cb32-3"><a href="#cb32-3"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="example-row-maximums" class="slide level2">
<h2>Example: row maximums</h2>
<p>This example combines row-indexing and a vectorized function, <code>max()</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="cb33-1"><a href="#cb33-1"></a>NumericVector row_max<span class="op">(</span>NumericMatrix mat<span class="op">)</span> <span class="op">{</span></span>
<span id="cb33-2"><a href="#cb33-2"></a>  <span class="dt">int</span> nrow <span class="op">=</span> mat<span class="op">.</span>nrow<span class="op">();</span></span>
<span id="cb33-3"><a href="#cb33-3"></a>  NumericVector max<span class="op">(</span>nrow<span class="op">);</span></span>
<span id="cb33-4"><a href="#cb33-4"></a>  <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> nrow<span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb33-5"><a href="#cb33-5"></a>    max<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> max<span class="op">(</span> m<span class="op">(</span>i<span class="op">,</span>_<span class="op">)</span> <span class="op">);</span></span>
<span id="cb33-6"><a href="#cb33-6"></a>  <span class="cf">return</span> max<span class="op">;</span></span>
<span id="cb33-7"><a href="#cb33-7"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="your-turn-1" class="slide level2">
<h2>Your turn</h2>
<p>The following R function can be used to simulate the value of <span class="math inline">\(\pi\)</span>:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a>approx_pi_r <span class="ot">&lt;-</span> <span class="cf">function</span>(N) {</span>
<span id="cb34-2"><a href="#cb34-2"></a>    x <span class="ot">&lt;-</span> <span class="fu">runif</span>(N)</span>
<span id="cb34-3"><a href="#cb34-3"></a>    y <span class="ot">&lt;-</span> <span class="fu">runif</span>(N)</span>
<span id="cb34-4"><a href="#cb34-4"></a>    d <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(x<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> y<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb34-5"><a href="#cb34-5"></a>    <span class="fu">return</span>(<span class="dv">4</span> <span class="sc">*</span> <span class="fu">sum</span>(d <span class="sc">&lt;</span> <span class="fl">1.0</span>) <span class="sc">/</span> N)</span>
<span id="cb34-6"><a href="#cb34-6"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Convert this to C++, taking advantage of the vectorized Rcpp functions.</p>
<aside class="notes">
<p>This function gets used in an exercise in the Rcpp packages session.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section></section>
<section>
<section id="end-matter" class="title-slide slide level1 inverse center">
<h1>End matter</h1>

</section>
<section id="references" class="slide level2">
<h2>References</h2>
<div class="smaller80">
<ul>
<li><p>Similar scope to this module: Gillespie, C and Lovelace, R, <em>Efficient R programming</em>, <em>Rcpp section</em>, <a href="https://csgillespie.github.io/efficientR/performance.html#rcpp" class="uri">https://csgillespie.github.io/efficientR/performance.html#rcpp</a></p></li>
<li><p>Going a bit further: Wickham, H, <em>Advanced R</em> (2nd edn), <em>Rewriting R code in C++ chapter</em>, <a href="https://adv-r.hadley.nz/rcpp.html" class="uri">https://adv-r.hadley.nz/rcpp.html</a></p></li>
<li><p>Not very polished, but broader coverage of Rcpp functionality: Tsuda, M.E., <em>Rcpp for everyone</em>, <a href="https://teuder.github.io/rcpp4everyone_en/300_Rmath.html" class="uri">https://teuder.github.io/rcpp4everyone_en/300_Rmath.html</a></p></li>
<li><p>The <strong>Rcpp</strong> vignettes, accessed via <code>browseVignettes("Rcpp")</code> or <a href="https://CRAN.R-project.org/package=Rcpp">CRAN</a></p></li>
<li><p>The unofficial <a href="https://thecoatlessprofessor.com/programming/cpp/unofficial-rcpp-api-documentation">Rcpp API documentation</a></p></li>
<li><p>Case studies (optimising by improving R code and/or using C++)</p>
<ul>
<li><a href="https://robotwealth.com/optimising-the-rsims-package-for-fast-backtesting-in-r/" class="uri">https://robotwealth.com/optimising-the-rsims-package-for-fast-backtesting-in-r/</a></li>
<li><a href="https://gallery.rcpp.org/articles/bayesian-time-series-changepoint/" class="uri">https://gallery.rcpp.org/articles/bayesian-time-series-changepoint/</a></li>
<li>The <a href="https://gallery.rcpp.org/">Rcpp Gallery</a> has all sorts of examples, many illustrating advanced features of Rcpp).</li>
</ul></li>
</ul>
</div>
</section>
<section id="license" class="slide level2">
<h2>License</h2>
<p>Licensed under a Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License (<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a>).</p>

<div class="footer footer-default">

</div>
</section></section>
    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="../../site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': true,
'smaller': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button', {
        text: function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
        }
      });
      clipboard.on('success', function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      });
      function tippyHover(el, contentFn) {
        const config = {
          allowHTML: true,
          content: contentFn,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start'
        };
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          return note.innerHTML;
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
          var filterRegex = new RegExp("https:\/\/github\.com\/Warwick-Stats-Resources\/advanced-r-packages");
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
              // target, if specified
              link.setAttribute("target", "_blank");
          }
        }
    });
    </script>
    

</body></html>